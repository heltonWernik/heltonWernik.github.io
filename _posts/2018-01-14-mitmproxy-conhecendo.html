---
layout: post
title: 'Mitmproxy 1 - Conhecendo '
date: '2018-01-14T11:22:00.005-08:00'
author: Israel Helton Wernik
tags: 
modified_time: '2018-01-14T11:23:09.467-08:00'
thumbnail: https://lh3.googleusercontent.com/NmtwceZFdy3rU3CVvYQG_8NYR4SdizbcNTCCLZynAWATfwWivineTLpqqs4ny6SaWWrcnczDSFOQHWkoXZ1PsYRC2HDksJNzqWgAwO6rqZtBvOwRKlDy3NDwC5mxNO6kNstDArdo=s72-c
blogger_id: tag:blogger.com,1999:blog-5213248075369348047.post-8751581469019834836
blogger_orig_url: https://cibersegurancawernik.blogspot.com/2018/01/mitmproxy-conhecendo.html
---

<div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="400" src="https://lh3.googleusercontent.com/NmtwceZFdy3rU3CVvYQG_8NYR4SdizbcNTCCLZynAWATfwWivineTLpqqs4ny6SaWWrcnczDSFOQHWkoXZ1PsYRC2HDksJNzqWgAwO6rqZtBvOwRKlDy3NDwC5mxNO6kNstDArdo" style="border: none; transform: rotate(0rad);" width="400" /></span></div><span id="docs-internal-guid-223defd0-f61f-4ea8-ed3e-59a6b6bf9a46"><br /></span><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 3pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; white-space: pre-wrap;">Neste artigo pretendo mostrar o funcionamento básico do mitmproxy, em breve farei outro artigo demonstrando como podemos usar essa ferramenta para ataques poderosos escrevendo nossos próprios scripts. </span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Mitmproxy é um proxy compatível com SSL que funciona como man-in-the-middle para comunicação HTTP e HTTPS. É uma ferramenta interativa muito boa que permite monitorar, modificar e reproduzir o tráfego HTTP / HTTPS que passa por ele. </span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Para poder espionar e modificar a comunicação HTTPS, o mitmproxy pretende ser o servidor para o cliente e o cliente para o servidor, enquanto está posicionado no meio, decodifica o tráfego de ambos. Mitmproxy gera certificados on-the-fly para enganar o cliente em acreditar que estão se comunicando com o servidor. </span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">mitmproxy se difere do mitmf que faz todo o trabalho hoje pesado por nós, mas só permite injetar codigos html ou javascript nas páginas em que o alvo entra, porém se quisermos enviar um .exe ou download? com o mitmproxy poderemos manualmete analisar e modificar qualquer packets(pacotes). &nbsp;</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Ele é um proxy como o SSlstrip que já falamos, porém diferente deste que tem um objetivo (downgrade de https para http) mitmproxy não faz nada, mas te dá uma liberdade para fazer o que quiser. </span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 16pt; margin-top: 0pt;"><span style="color: #666666; font-family: &quot;arial&quot;; font-size: 15pt; vertical-align: baseline; white-space: pre-wrap;">Instalação</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Vamos fazer o download na pagina: </span><a href="https://github.com/mitmproxy/mitmproxy/releases" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">https://github.com/mitmproxy/mitmproxy/releases</span></a></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="222" src="https://lh3.googleusercontent.com/BVgrzJJ2qoSVWY3HnCUGhtsPyItIBkWme91rveXDT6DyFUHT8vPvj2QGhSxN8ODU_10sIfWbr7n5hSJ2fd6vdOrT6kKlRcUJO3P7ZU6UFqiV3cgesPGB1tAt-FdPZR_6ES1SZr9o" style="border: none; transform: rotate(0rad);" width="400" /></span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Extrair os arquivos &nbsp;e colocar na pasta opt (optional applications) dentro de uma nova pasta chamada mitmproxy</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="167" src="https://lh4.googleusercontent.com/UmtrWX5VZBmXcnRAqXU2EqzhlKLIJGsiLpXAbE0aWK99NvIUA2roPuA174x13GHpGyE9Yyuq2KhxMsoo8jotGTqosp7IPYtqbmkScpatkvE8JQVFVE5wMMEZyI_Nx9yYMWQGs85q" style="border: none; transform: rotate(0rad);" width="430" /></span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">São três programas, mitmdump é o modelo em formato de linha de comando, mitmproxy é a ferramenta principal e mitmweb é com uma interface web.</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Vamos imaginar que queremos atacar quando um usuário entrar em certa página, antes disso precisamos analisar o que acontece quando alguém entra naquela página web, para poder criar uma tática correta.</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Para isso vamos iniciar o mitmweb no terminal</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">&gt; cd /opt/mitmproxy</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">&gt; ls</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">&gt; ./mitmweb</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="159" src="https://lh5.googleusercontent.com/YvOVaR-EYXTaN9aJ9lHjDe5zt8EE5NMetqR54m5Jxt_fw4yTK0AAp6W76vRC8xOMJii8P9-fVF6q8uXn6puTA3kl9ky2lb14RFcm67Yi7lBFkvwUFoNPox2HVMCtf70llBSIAcjK" style="border: none; transform: rotate(0rad);" width="602" /></span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Podemos ver que foi iniciado duas URL, a primeira, proxy server é o endereço onde o proxy está sendo rodado, interceptando packets, no segundo URL temos a interface web na qual podemos utilizar o proxy.</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Vamos copiar o web server e copiar no navegador.</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="105" src="https://lh4.googleusercontent.com/luzJcrYyYQRvTVIBSLJcJzDDKw-5N7rhIi4m32OUw8JR6MymXAkTIjG3wbQnzrIVyCmQ1Th8xkbketXEmbUZbKAS48xnd730QNSmHF9WnUfxr8xSRNelBEr5egz9yQPS5zkDr84b" style="border: none; transform: rotate(0rad);" width="602" /></span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"> </span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Podemos ver uma simples interface web na qual podemos ver os packets abaixo, filtrá-las e intercepta-las. Por enquanto não há packets pois não temos nenhum tráfego na rede. </span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">O mitmproxy tem duas formas principais de funcionamento </span></div><ol style="margin-bottom: 0pt; margin-top: 0pt;"><li dir="ltr" style="font-family: Arial; font-size: 11pt; font-variant-east-asian: normal; font-variant-numeric: normal; list-style-type: decimal; vertical-align: baseline; white-space: pre;"><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-size: 11pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">Explicit - O usuário se conecta diretamente ao proxy, esse é o modo padrão</span></div></li><li dir="ltr" style="font-family: Arial; font-size: 11pt; font-variant-east-asian: normal; font-variant-numeric: normal; list-style-type: decimal; vertical-align: baseline; white-space: pre;"><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-size: 11pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">Transparent - os dados são redirecionados ao proxy</span></div></li></ol><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Por enquanto vamos somente ler e analisar os dados, para isso utilizaremos o modo padrão, que é o modo explicito.</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Precisamos configurar nosso navegador para se conectar com o proxy e enviar data para ele.</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">no firefox do kali:</span><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"> Menu - preferences - advanced - network - settings </span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">Marcar a opção:</span><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"> Manual proxy configuration</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">O endereço será local host pois o mitmprox está rodando em nosso computador. </span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">Http proxy: 127.0.0.1</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Porta: devemos ver a porta que o mitmf está rodando no terminal, como podemos ver na imagem acima que o proxy server está rodando na porta 8080</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">Port: 8080</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">OK</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="371" src="https://lh5.googleusercontent.com/Eg9umJ8BpMij2PRddCPGKBWYJsgCSLTTc9cGXr4XhBBBweh4m7yddBxvQ2Gky_3Frjas5PbPrGciefAuFcFfIVSphsHv5ePQr35kRvmdjNxYjhQmMrmHvn9kqOZ3kYU0oIKWp76H" style="border: none; transform: rotate(0rad);" width="602" /></span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">O que acontece agora é que qualquer dado no navegador firefox, a dado vai passar antes pelo mitmproxy e depois vai para a web, e quando receber dados, ele vai passar pelo mitmproxy e depois para o navegador, pois configuramos manualmente para usar o mitmproxy como o proxy, como se disséssemos ao navegador que confiamos nesse proxy.</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Qualquer acesso pelo navegador, banco, jogo, filmes passam antes pelo proxy, vamos estudar como receber esses dados e criar a estratégia de ataque. </span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="131" src="https://lh6.googleusercontent.com/XxxGHzRnHRlA6mFFCbtd2T0dOSaF07tvEZ14zhxdop4ZFPp2lswMwoZZd3Aj0Z_xu_Yy9OAiGDktHGNiq_iHj80H_T-Z3wMbkN6SC2d9mbuS9hOYVhJKMRvJAviqqahxviqIm5ZS" style="border: none; transform: rotate(0rad);" width="350" /></span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Estamos fazendo isso no nosso próprio computador para aprendermos como analisar os dados recebidos, posteriormente vamos ver como usar o mitmproxy para atacar diferentes computadores. </span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Agora vamos abrir o navegador, entrar em uma página e ver o que acontece entrando no bing.com: </span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="291" src="https://lh6.googleusercontent.com/ynkSSxxX_MMS2Gtr9iywZ0A-Pe7dy4c5EMsdwEoy4kNzfY0d1spz6peH4Qafjdu3DgaB8aMLeQDRMM7V7muudxe5Iu8tmeI9no7sOQeIZ1827jQErOpoG9QCyqgTgegRQs3Vx9xE" style="border: none; transform: rotate(0rad);" width="602" /></span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Depois de usar a ferramenta é importante lembrar de retirar &nbsp;o proxy da navegação indo novamente, pois se não desmarcar isso quando desligar o mitmproxy o navegador vai perder a conexão pois não encontra o proxy para se conectar.</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">no firefox do kali:</span><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"> Menu - preferences - advanced - network - settings </span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">Marcar a opção:</span><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"> No proxy</span></div><br /><h1 dir="ltr" style="line-height: 1.38; margin-bottom: 6pt; margin-top: 20pt;"><span style="font-family: &quot;arial&quot;; font-size: 20pt; font-weight: 400; vertical-align: baseline; white-space: pre-wrap;">Analisando dados </span></h1><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Sempre que solicitamos ao navegador para entrar em um site ele comeca com essa ordem.</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">No primeiro vemos um pedido para entrar no bing.com, vamos clicar nele e entender melhor.</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="169" src="https://lh3.googleusercontent.com/TjA5eAYKoWYYFE1po3piEd70P0U-QR3l_DJG8pO1YVncKeHLQe50Z6T5KPpBiVTZt0HcSZ3PBtssAldoKUIMBTv7G8jIUIFoJT6LCiLrPkoPhyrPzWbgh0nG8VPRQ_IgB-7gLzbu" style="border: none; transform: rotate(0rad);" width="602" /></span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Vemos um GET para o bing.com</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">o User-agent mozilla</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Clicando em Response vemos:</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="393" src="https://lh5.googleusercontent.com/pYd_46fiURg_7VneS2upsxKBJqx1pRtngvPck-qoCkWxMpG_2IkZoSdNGEzasiVgkWe0LOogTvGCLbQdeBGhV2GT5mrImSW554Bgd5c0sleSzU59Ml3ngvx1xWYhMzDRF3BwOCfe" style="border: none; transform: rotate(0rad);" width="450" /></span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Que é a resposta que o navegador recebe quando ele solicita o bing.com, em Date vemos o código html que o usuário recebe quando ele se conecta a essa página </span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Na barra de navegação acima: </span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="55" src="https://lh4.googleusercontent.com/BsscjBEnkheGF6TRDOxcEJBN5cvzg9ijXRgT2ERq7JPXz5jBGW5VeYmGfR5z3T-GSD-Z4pEzNqzD1C_BINDBxYclzwmJwsuNiYR6mK6CJ6tq-qWaBkjm321ViRucG89VUDdQuBgz" style="border: none; transform: rotate(0rad);" width="602" /></span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Search: encontrar alguma palavra nos packets</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Intercept: Para interceptar packets (veremos como usar depois)</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 16pt; margin-top: 0pt;"><span style="color: #666666; font-family: &quot;arial&quot;; font-size: 15pt; vertical-align: baseline; white-space: pre-wrap;">Search</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Ao clicar na opção Search ele já oferece várias opções de busca: </span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="362" src="https://lh4.googleusercontent.com/DEdP-YjkhDjDYFV7CftH1GBB5qV5FOEV-xwtFygEDnnfFEECWlgy9OIC9mr_S6kYKUyRwjdAUTJAPKe0FIUr7-1ydJ4jGNxeaUUh5i1I4ilxvYzhXBvrmleygx7catHAM-r-NFw6" style="border: none; transform: rotate(0rad);" width="323" /></span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Por exemplo usando a primeira pesquisa ~a que significa assets como CSS, Javascript, flash e imagens ele só irá me mostrar esses componentes: Como vemos abaixo dois Javascript e uma imagem.</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="142" src="https://lh3.googleusercontent.com/7-vugOrJrZrO6MktDe8vEi6w8fYeL1xnIyBC7reJLfYhppN2AwcV1oPPs6QQ-SEPidC4f1ql9ZiGlwH8a_9hCdNk3YsJ-F2Yz5IR233iuuOawAqfQE56MvP7qkMlu0Z2hetbd2yR" style="border: none; transform: rotate(0rad);" width="354" /></span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Selecionando a imagem por exemplo, podemos baixar ela se quisermos como demonstrado no quadro a direita da imagem abaixo.</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="121" src="https://lh6.googleusercontent.com/a_qG9yPXRdrQHe9pM8ZHIizMY73AKiEHezGbLcqO4mfJsqlfBXxfSTd7ChPLHMd_gcyD_leYP31wtJ_XISnGgD7sr7wxn9CWCXhyZUvwEUi5y1KAmzv_r6Gnjzswv_YbICRITncY" style="border: none; transform: rotate(0rad);" width="602" /></span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Podemos usar para filtrar o que quisermos, se a intenção é procurar somente javascript por exemplo se faz o comando ~a .js </span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Podemos usar também o comando ~m method que procura por algum método por exemplo ~m POST </span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="146" src="https://lh4.googleusercontent.com/WcHZp9tI-8NTtW71cr86GjyiZbNWWquXPHnWr3UELBj7mC6eJ0-DqZWOmcquRag-aoBt3pip_Kg59YAjq01BMexVxpjFIZc30VWB5BUEhLMRWDoKkCwtc8BHecQ9OIRZsXs6abVs" style="border: none; transform: rotate(0rad);" width="430" /></span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 16pt; margin-top: 0pt;"><span style="color: #666666; font-family: &quot;arial&quot;; font-size: 15pt; vertical-align: baseline; white-space: pre-wrap;">Highlight</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="color: #666666; font-family: &quot;arial&quot;; font-size: 15pt; vertical-align: baseline; white-space: pre-wrap;"><img height="297" src="https://lh5.googleusercontent.com/kWtVhwQo0bCJSq0LaSKGxw9We4MoHHkEWRoxnhy3nVt0Js2bhBfdauW08B3QxYxZO8r144QHmT3lNL_Ky-DZaqFR22jLG8_yT6TeE7gsBKxS57EIAzqx07JlV_7jd-f4rOlJ5uXh" style="border: none; transform: rotate(0rad);" width="257" /></span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">O highlight é bem similar ao search, porém ele não filtra ele apenas marca a pesquisa desejadas, se fizermos o mesmo comando anterior ficará assim:</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 16pt; margin-top: 0pt;"><span style="color: #666666; font-family: &quot;arial&quot;; font-size: 15pt; vertical-align: baseline; white-space: pre-wrap;"><img height="240" src="https://lh6.googleusercontent.com/l6jOIcqhrEEvXooQdPwfsGu8PWeqQ6CvWOYFRhQhs8eNPFhNrnQBJEq-4kAM59rbQ9i-CsWHrQQMHwM7SjJaDSUWBnQsEDxrPLjvIc5w1Y9lE1YlciI_nD4YcUiC0JipLp9lG4YC" style="border: none; transform: rotate(0rad);" width="368" /></span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 16pt; margin-top: 0pt;"><span style="color: #666666; font-family: &quot;arial&quot;; font-size: 15pt; vertical-align: baseline; white-space: pre-wrap;">Interceptando packets</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"> Vamos ver como interceptar e evitar ou editar determinado packet antes de chegar ao alvo ou ao destino:</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Com o mitmproxy iniciado e o navegador passando por ele:</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Iniciamos o Bing.com</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="353" src="https://lh5.googleusercontent.com/XW3uH2qBvNVQ3Icw-1ZlYKO97ryKLm3cyQ0dpVjgQ3kX4FjCv0TDgHC2eKyZp-7SECNvs9BHOlxNKlrWnfJtKLWnWeYif4uHOySjFoZzw6F1--XR7xcYBhdkx9Huzeqx6sEHCgOX" style="border: none; transform: rotate(0rad);" width="602" /></span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Colocamos para interceptar os POST com o comando no campo intercept ~m POST.</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Há embaixo a esquerda um botão verde intercept ~m POST, significa que qualquer método POST será interceptado.</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Agora vamos ao bing e pesquisar por qualquer coisa: "test"</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="264" src="https://lh6.googleusercontent.com/5YwFZWH0ZPrDkBpRbolyfOwxQEF43IPWvDNGaI3NsaZH0JydY7sVzc0ysXIxrpnOr1hut3az3WmbyRLhXVStezIMwLi2Z5HRS7qqB8jP1GxuU3ZcaIKct5KL1Me6AgM664R2p_0Z" style="border: none; transform: rotate(0rad);" width="602" /></span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Podemos ver que todos os POST REQUEST foram pausados</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="201" src="https://lh6.googleusercontent.com/dgc3mHrw0Y0mqZjlDGLx5mXCqAl3FUVkkS5wo5iNqnhm2WE35Y2xsNcXqnr_kQliBZPlAmEx9zA1hGT905nPfqT2cLjj7YbQN5dXHWmlx6Q7hIJ9PnTEhrgENVv4_rkP6d4z2cvI" style="border: none; transform: rotate(0rad);" width="602" /></span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Se clicamos nele podemos ver todas as informações , e se clicamos em Resume acima ele é enfim enviado ao alvo.</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="361" src="https://lh3.googleusercontent.com/nIaPJxh7rzauZF6reUwaQRuWmBrtmhqEtghe9tcCiskF_iDuoo0_G1Yqr--KcoYRArNqCtC04X1f1tU69LfxlqClTu_qekb-Cx2ICsgxIvoxWViU8BmoNf5AIRniY1aG7QzcEcpW" style="border: none; transform: rotate(0rad);" width="602" /></span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Como podemos ver esse POST foi liberado ao alvo, e será enviado após 2 minutos pois o pausamos</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="97" src="https://lh6.googleusercontent.com/Bd1sK3hkOqwDSX8tnEs_QUdEJaTSJssHjHQdkDJt5g4BkYYbaw5kVsriKLDzzsgR89HYnhwoMUntebccKRHWD62cSHVjk1BuOwurvo0EA8plpTR-P9h5RhTg7nsJt12EfB-5J4-V" style="border: none; transform: rotate(0rad);" width="602" /></span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">No menu acima podemos fazer Downolad, duplicar deletar e até abortar essa solicitação.</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="105" src="https://lh5.googleusercontent.com/q_iQrqrQqqmpS_nOPnchbttEjd8NslloJYHuokVVtrYEC-iKY8-1P3vgmyKZsQ-9m7_Lc8rsAFgGGKtbOuLzy6L1iQxDmMqvuUQg8nFVDuFZ89KN5TVeFmjgAoqoQyxc0mSlkCWy" style="border: none; transform: rotate(0rad);" width="602" /></span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Vamos ver outro exemplo fazendo escrevendo no campo de pesquisa /* que irá interceptar tudo</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Quando tentamos entrar em qualquer site o proxy pausa tudo e não é possível entrar no site como podemos ver nas solicitações abaixo</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="265" src="https://lh6.googleusercontent.com/VNuJMO1vR5SCRIUtRuXh6Y0qlBCyPSmZ3FpBBfkNwsAajjhECniEr4dDlN9SfCQW7Xn266BQy9jkPlcVO1sdZyY1-pQ7BvxAPcNZQzADvVwoLpktX5E104TTCTVFMvl5tRT3im9F" style="border: none; transform: rotate(0rad);" width="602" /></span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 16pt; margin-top: 0pt;"><span style="color: #666666; font-family: &quot;arial&quot;; font-size: 15pt; vertical-align: baseline; white-space: pre-wrap;">Interceptando packets e modificando packets On-The-Fly</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Antes vamos analisar, criar uma estratégia de ataque e decidir o que modificar.</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">O alvo entrou no Bing.com vamos enteder quais as respostas que ele recebe do servidor</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Essa é a informação que o proxy recebe de uma simples solicitação ao site Bing.com Filtrando as respostas com o comando ~s</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="169" src="https://lh4.googleusercontent.com/-J6Ou0slkjbQLT4yhrAVytmlhhLo8yaEYVh4PuiVYf97CcUokCJKwigE8VUltm0aezmQx1qMIDUGyHmyTqyno1x8qRjP5dH-KnKxAQcuCGNBw6wYFrYxvOYPMlB2JghbFXRiepac" style="border: none; transform: rotate(0rad);" width="602" /></span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">O primeiro quando abrimos e clicamos em Response teremos o código html da página que será enviada ao alvo, e assim com cada elemento acima como imagens e códigos serão enviados ao alvo.</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Sendo o atacante um proxy de mitmproxy ele pode modificar qualquer parte para enviar ao alvo, html, javascript imagens ou qualquer coisa.</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">vamos clicar na página do Bing e ver o código fonte </span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="307" src="https://lh3.googleusercontent.com/_5LgSN4OC5eW6gbOjHukQaw6KfnOYFiwj_mTnPRkddiO69xKImKhvWM4M8357A33wu8fT6sAK0v6GwqDRs83mfjqAXKsPjZdCYNoYYPT_pnqUEBlGsL5gxNCranyHG_niemHiD5K" style="border: none; transform: rotate(0rad);" width="602" /></span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">A página termina com o tag &lt;/body&gt; podemos colocar Javascript em qualquer lugar da página, mas o melhor lugar é após o tag de &lt;/body&gt; pois o alvo não saberá que este código está sendo executado. </span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Vamos agora fazer outra pesquisa com o comando ~bs que significa response body</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="142" src="https://lh6.googleusercontent.com/UmrUkNBXLtbkSf7Qi3N-ok236EEI0uazuPo9cAbLNfc5kiNLMWfJ7tkTnbHIW-tm6dGRHjBkqESU8tcbTgRdpEirwSuKOevGJ5Fgmb6PgAliSfL7v5Uoo85TifYXOAhBjngtLDBN" style="border: none; transform: rotate(0rad);" width="257" /></span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Como estamos procurando o comando &lt;/body&gt; para injetar o Javascript antes </span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="73" src="https://lh3.googleusercontent.com/1YIrnbS-4-vT3TRg9Kbk2wFfnsxj_AnPWUqe1XTkZh8Z_PLJM5jkYvMM9QUcOHeXFpCwvytxYgPAm9rStjd6leLYOJlSVoo1G6MfD3F7bsz3i7dZg43MNFQfLEvPB6ilxw3PVjgc" style="border: none; transform: rotate(0rad);" width="261" /></span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Logo vemos um erro porém mesmo assim ele funciona</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Agora quando o alvo fizer um refresh na página do Bing vai ficar pensando e não vai entrar na página pois ela está sendo interceptada pois contém o tag &lt;/body&gt;</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="296" src="https://lh3.googleusercontent.com/2k03mlpCmOd0skRK2l7gpPOjMCz3Dkpkc3t7QZMtV0Jrf1rhYJI7EMjLsC0i7hbfFwzMqj5gHqv7abtXB5NqcwvkcNxGjHgg3EFCDp0Chc7jWy3WsE6Zdx9vnqHUhF-J9w9m943p" style="border: none; transform: rotate(0rad);" width="602" /></span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Podemos ver que foi interceptado e para modificar e inserir nosso código precisa clicar na caneta acima e injetar o código antes da tag &lt;/body&gt;</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">o Código será bem simples para testar: &lt;script&gt;alert('test');&lt;/script&gt;</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="89" src="https://lh5.googleusercontent.com/6EiIzWaZ8xg5AOWGuLOZjkg6ViJWHXAZvckF4mQn3vdGd0kxFCXNigXDu3NzT2emJLDIW4waAl6slXz59GLnkXBsuAMFzhcTnMnfFavagQwOsD-0IKTJArT5cfYmOPGYudu6DjPI" style="border: none; transform: rotate(0rad);" width="602" /></span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Salvamos a mudança, (há um bug que o botão some quando queremos salvar para concertar clicar encima do Date pressionando tab no qual vai levar para a outra guia "Details", depois volta a Response e salva ) </span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="374" src="https://lh3.googleusercontent.com/Ta2cs55ltF9eyG_pI0O2XKDQuSbpxilSBfd8k1sa9PRMexOG2mZouht7ohpXQAnoHGiQi1iQpsk0x7tg84xE1YRBaUX9LYm8LNEgAX6Wh8lyFXPVTxcB8hfNUqPE0Mjw4AAUZaMi" style="border: none; transform: rotate(0rad);" width="375" /></span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Agora só precisamos liberar o pacote ao alvo, clicamos no que pausamos, vamos em Flow acima e Resume</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Voilá </span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;"><img height="333" src="https://lh3.googleusercontent.com/lSEwvzhARfiQbWo2x4wWRCN3zn4yJrtDJirLVq5LsAS_tCQN_ZJXcgan96KAe_menE1KZDGGi5ZWo_ORKrpUrAFdq_vggT1p_9VbqKkRLnwOmU0N96zcb1IB1HhJ1kUhI13xjdt8" style="border: none; transform: rotate(0rad);" width="602" /></span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">O código foi injetado :)</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Por enquanto apenas conhecemos no próprio computador, aprendemos a analisar os dados, depois aprenderemos como atacar outras máquinas conectadas na mesma rede ou com um fake access point e injetar códigos mais poderosos. </span></div><br /><h1 dir="ltr" style="line-height: 1.38; margin-bottom: 6pt; margin-top: 20pt;"><span style="font-family: &quot;arial&quot;; font-size: 20pt; font-weight: 400; vertical-align: baseline; white-space: pre-wrap;">Funcionando no mundo real - Modo Transparente</span></h1><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Podemos entrar em uma máquina diferente como MITM, ettercap, arp spoofing, fake AP… e redirecionar os dados da porta 80 para o mitmproxy.</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">Vamos fazer com Ettercap (</span><a href="https://cibersegurancawernik.blogspot.co.il/2018/01/ettercap-e-ultrapassando-seguranca-do.html" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">https://cibersegurancawernik.blogspot.co.il/2018/01/ettercap-e-ultrapassando-seguranca-do.html</span></a><span style="font-family: &quot;arial&quot;; font-size: 11pt; vertical-align: baseline; white-space: pre-wrap;">)</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 11pt; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">&gt; </span><span style="font-family: &quot;arial&quot;; font-size: 12pt; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">ettercap -Tq -M arp:remote -i eth0 -S /10.20.215.9// /10.20.215.1//</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 12pt; vertical-align: baseline; white-space: pre-wrap;">Agora que somos MITM tudo que a máquina faz é redirecionada ao Kali pois o windows pensa que ele é o Router.</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 12pt; vertical-align: baseline; white-space: pre-wrap;">Agora redirecionaremos o tráfego do alvo para nossa porta do mitmproxy como fizemos com o SSlstrip veja tudo mais detalhado no post sobre Ettercap.</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 12pt; vertical-align: baseline; white-space: pre-wrap;">Adicionaremos o tráfego da porta 80 para porta 8080. Isso é o equivalente a configurar o navegador da vítima para utilizar nosso mitmproxy</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: white; font-family: &quot;arial&quot;; font-size: 12pt; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">&gt; iptables -t -nat -A PREROUTING -p tcp --destination-port 80 -j REDIRECT --to-port 8080</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 12pt; vertical-align: baseline; white-space: pre-wrap;">Agora que direcionamos a vítima para porta 8080 precisamos iniciar nosso mitmproxy, porém faremos um comando diferente para ele ser transparente, ou seja o navegador não está configurado, somente arpspoof e iptables. </span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 12pt; vertical-align: baseline; white-space: pre-wrap;">dentro do diretorio opt/mitmproxy#</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 12pt; vertical-align: baseline; white-space: pre-wrap;">&gt; ./mitmweb --transparent</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 12pt; vertical-align: baseline; white-space: pre-wrap;"><img height="95" src="https://lh5.googleusercontent.com/d1hHR3sngDVbcJ_jbKDKSe_fYB6sTtLdB76g5vjYbjvYkolh8TIzXcLz_aZwiAYDbVrAIMOss7P-SJiM8bqDGNUwz0i1pgy8WfgBDshzeM0XDlC23jLccu0uozv_STNeAocfKxZe" style="border: none; transform: rotate(0rad);" width="602" /></span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 12pt; vertical-align: baseline; white-space: pre-wrap;">Agora vamos ao navegador do Kali e entramos no endereço onde está rodando o mitmproxy web server 127.0.0.1:8081</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 12pt; vertical-align: baseline; white-space: pre-wrap;"><img height="412" src="https://lh3.googleusercontent.com/dKeZBorIZikfezgvz7KTITU15_v_IaXO_Q9mbCpiDZA7aYSgANitoUu-B5g1yk32vWkV8jGxjLCea_I6PG3nsOAwG7TgGwb4tZuPyoe1xyAUYIttcY-TP1kxF4PuUl2V3XT9R2Ne" style="border: none; transform: rotate(0rad);" width="602" /></span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 12pt; vertical-align: baseline; white-space: pre-wrap;">Podemos reparar embaixo, de verde que está no modo transparent</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 12pt; vertical-align: baseline; white-space: pre-wrap;">Agora, entrando na máquina do alvo, acessando qualquer site e estamos recebendo todos os pacotes da vítima e podemos modificar qualquer coisa.. :</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 12pt; vertical-align: baseline; white-space: pre-wrap;"><img height="395" src="https://lh4.googleusercontent.com/feoY_o18WxEozOKFg9NK1z68iqBxQxRzjwjw8lS6IazO0PUIYrSgDFlkcP6we1-OVy3t-6vzYXssheEbHvEiJTEBkLt0LaGaLGJLHQmcX1ByOhbzJi77yfEMrzX6DDPzet4UQrA6" style="border: none; transform: rotate(0rad);" width="602" /></span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 12pt; vertical-align: baseline; white-space: pre-wrap;">Sempre é bom testar os ataques em nossa própria máquina antes.</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 16pt; margin-top: 0pt;"><span style="color: #666666; font-family: &quot;arial&quot;; font-size: 15pt; vertical-align: baseline; white-space: pre-wrap;">Desligando</span></div><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;arial&quot;; font-size: 12pt; vertical-align: baseline; white-space: pre-wrap;">Depois do ataque devemos re-configurar o Iptables e desligar o server do mitmproxy para o alvo não perder conexão. </span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: white; font-family: &quot;arial&quot;; font-size: 12pt; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">&gt; iptables -t -nat --flush</span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: white; font-family: &quot;arial&quot;; font-size: 12pt; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;"><img height="380" src="https://lh3.googleusercontent.com/6XGbP78dHqywIqXYd0cVcUmjEgSkx4K0tfbUDKIJNHXrA6CGHncHkFdd-D1kxtQQ71aifJDuQYUWCIc84sUnb5WBOpLFz6EJFDOX0d6WTDr8W5UjLhvqWrDdhJZi-lfQKxEub8Ai" style="border: none; transform: rotate(0rad);" width="602" /></span></div><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: white; font-family: &quot;arial&quot;; font-size: 12pt; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">Em outro post demonstrarei como utilizar essa técnica com ataques mais poderosos e como escrever nossos próprios scripts.</span></div>