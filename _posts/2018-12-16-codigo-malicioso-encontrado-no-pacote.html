---
layout: post
title: Código malicioso no pacote npm event-stream foi baixado mais de 8 milhões
  de vezes
date: '2018-12-16T02:04:00.003-08:00'
author: Israel Helton Wernik
tags: 
modified_time: '2018-12-16T02:04:40.034-08:00'
thumbnail: https://lh6.googleusercontent.com/3VWw_Dt4CRrPAEKdQTzLK55BOFHDQ2d3MPEak64XPdKvH71AQO7_9aiSCNAIyus-9B9GuMwt7Na7z5-WqicBYIYZiDYT6a3lUx3ayHryglqbt9-vxRe9ViamMTiUm8xexQF8XThm=s72-c
blogger_id: tag:blogger.com,1999:blog-5213248075369348047.post-6742029252107291678
blogger_orig_url: https://cibersegurancawernik.blogspot.com/2018/12/codigo-malicioso-encontrado-no-pacote.html
---

<div dir="ltr" style="background-color: white; line-height: 1.872; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">Descobriu-se que um pacote npm amplamente utilizado, </span><span style="background-color: #f4f4f6; color: #b51b72; font-family: &quot;Courier New&quot;; font-size: 10.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">event-stream</span><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">, contém um pacote malicioso denominado </span><span style="background-color: #f4f4f6; color: #b51b72; font-family: &quot;Courier New&quot;; font-size: 10.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">flatmap-stream</span><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">. </span><a href="https://github.com/dominictarr/event-stream/issues/116" style="text-decoration-line: none;"><span style="background-color: transparent; color: #188a8a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space: pre-wrap;">Isso foi divulgado por meio de uma questão do GitHub levantada contra o repositório de origem</span></a><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">.</span></div><div dir="ltr" style="background-color: white; line-height: 1.872; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">O pacote </span><span style="background-color: #f4f4f6; color: #b51b72; font-family: &quot;Courier New&quot;; font-size: 10.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">event-stream</span><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;"> facilita a criação e o trabalho com fluxos e é muito popular, obtendo cerca de 2 milhões de downloads por semana. O pacote filho mal-intencionado foi baixado quase 8 milhões de vezes desde sua inclusão em setembro de 2018.</span></div><div dir="ltr" style="background-color: white; line-height: 1.872; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">Se o seu projeto está sendo monitorado por uma ferramenta de detecção por vulnerabilidades em dependências, como o Snyk você será notificado via alertas de rotina.</span></div><div dir="ltr" style="background-color: white; line-height: 1.872; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;"><br /></span></div><div dir="ltr" style="background-color: white; line-height: 1.872; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;"><img alt="Resultado de imagem para npm" height="77" src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/db/Npm-logo.svg/1200px-Npm-logo.svg.png" width="200" /></span></div><h2 dir="ltr" style="background-color: white; line-height: 1.44; margin-bottom: 4pt; margin-top: 0pt; padding: 15pt 0pt;"><span style="background-color: transparent; color: #212529; font-family: Arial; font-size: 18pt; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 400; vertical-align: baseline; white-space: pre-wrap;"><a name='more'></a></span></h2><h2 dir="ltr" style="background-color: white; line-height: 1.44; margin-bottom: 4pt; margin-top: 0pt; padding: 15pt 0pt;"><span style="background-color: transparent; color: #212529; font-family: Arial; font-size: 18pt; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 400; vertical-align: baseline; white-space: pre-wrap;">Veja como os eventos se desdobraram:</span></h2><div dir="ltr" style="background-color: white; line-height: 1.872; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">O pacote npm </span><span style="background-color: #f4f4f6; color: #b51b72; font-family: &quot;Courier New&quot;; font-size: 10.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">event-stream</span><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">, embora popular, não é mantido ativamente. Na verdade, o pacote não foi atualizado por alguns anos, exceto por algumas alterações estéticas do README - e pela biblioteca maliciosa em questão.</span></div><div dir="ltr" style="background-color: white; line-height: 1.872; margin-bottom: 0pt; margin-top: 0pt;"><br /></div><div dir="ltr" style="background-color: white; line-height: 1.872; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">O invasor presumido, cujo controle do GitHub está correto, ofereceu-se para ajudar a manter a biblioteca. O mantenedor original, Dominic Tarr - provavelmente com o objetivo de ajudar seus usuários - concordou, concedendo direitos de publicação right9ctrl. É importante notar que a transferência de propriedade é uma prática bastante comum no mundo do código aberto, usada para ajudar a manter projetos quando os autores originais não são mais capazes ou estão dispostos a fazê-lo.</span></div><div dir="ltr" style="background-color: white; line-height: 1.872; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">Infelizmente, este novo proprietário começou a adicionar uma biblioteca maliciosa chamada </span><span style="background-color: #f4f4f6; color: #b51b72; font-family: &quot;Courier New&quot;; font-size: 10.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">flatmap-stream </span><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">ao pacote </span><span style="background-color: #f4f4f6; color: #b51b72; font-family: &quot;Courier New&quot;; font-size: 10.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">event-stream</span><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;"> como uma dependência, levando ao seu download e invocação por cada usuário do pacote </span><span style="background-color: #f4f4f6; color: #b51b72; font-family: &quot;Courier New&quot;; font-size: 10.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">event-stream</span><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;"> (usando a versão 3.3.6). O download da biblioteca maliciosa atingiu quase </span><a href="https://npm-stat.com/charts.html?package=flatmap-stream&amp;from=2018-09-05&amp;to=2018-11-27" style="text-decoration-line: none;"><span style="background-color: transparent; color: #188a8a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space: pre-wrap;">8 milhões de</span></a><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;"> downloads até o momento.</span></div><div dir="ltr" style="background-color: white; line-height: 1.872; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;"><img height="144" src="https://lh6.googleusercontent.com/3VWw_Dt4CRrPAEKdQTzLK55BOFHDQ2d3MPEak64XPdKvH71AQO7_9aiSCNAIyus-9B9GuMwt7Na7z5-WqicBYIYZiDYT6a3lUx3ayHryglqbt9-vxRe9ViamMTiUm8xexQF8XThm" style="border: none; transform: rotate(0rad);" width="602" /></span></div><div dir="ltr" style="background-color: white; line-height: 1.872; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">Como a adição de bibliotecas é uma prática comum, é fácil ver como a nova biblioteca não foi revisada com muito cuidado. Além disso, a biblioteca parece ter realizado a funcionalidade prometida (manipulando um flat map stream). Por último, o código malicioso dentro da biblioteca foi ofuscado para evitar a detecção (foi </span><a href="https://github.com/dominictarr/event-stream/issues/116#issuecomment-441744514" style="text-decoration-line: none;"><span style="background-color: transparent; color: #188a8a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space: pre-wrap;">posteriormente decodificado</span></a><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;"> para revelar o código malicioso).</span></div><div dir="ltr" style="background-color: white; line-height: 1.872; margin-bottom: 0pt; margin-top: 0pt;"><br /></div><div dir="ltr" style="background-color: white; line-height: 1.872; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">A dependência maliciosa permaneceu sem ser detectada por 2,5 meses, até que </span><a href="https://github.com/dominictarr/event-stream/issues/116" style="text-decoration-line: none;"><span style="background-color: transparent; color: #188a8a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space: pre-wrap;">um usuário, Ayrton Sparling</span></a><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">, notou e relatou uma dependência estranha no dia 20 de novembro. A dependência - que continha código ofuscado - foi rapidamente entendida como maliciosa, cuja notícia se tornou mais conhecida (26 de novembro).</span></div><div dir="ltr" style="background-color: white; line-height: 1.872; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">O npm também respondeu ao incidente e publicou , </span><span style="background-color: #f4f4f6; color: #b51b72; font-family: &quot;Courier New&quot;; font-size: 10.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">flatmap-stream</span><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">, como uma dependencia maliciosa do </span><span style="background-color: #f4f4f6; color: #b51b72; font-family: &quot;Courier New&quot;; font-size: 10.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">event-stream</span><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">.</span></div><div dir="ltr" style="background-color: white; line-height: 1.872; margin-bottom: 0pt; margin-top: 0pt;"><br /></div><div dir="ltr" style="background-color: white; line-height: 1.872; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">Quanto às ações maliciosas em si, parece que o código focou em roubar bitcoins da aplicação, redirecionando quaisquer bitcoins extraídos para a carteira do atacante (em vez do alvo pretendido). </span><span style="background-color: transparent; color: #252525; font-family: Roboto; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">O código malicioso pôde verificar se o pacote </span><span style="background-color: #f4f4f6; color: #b51b72; font-family: &quot;Courier New&quot;; font-size: 10.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">copay-dash </span><span style="background-color: transparent; color: #252525; font-family: Roboto; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">foi instalado e, em seguida, tentar roubar os bitcoins armazenados nele.</span></div><div dir="ltr" style="background-color: white; line-height: 1.872; margin-bottom: 0pt; margin-top: 0pt;"><br /></div><div dir="ltr" style="background-color: white; line-height: 1.872; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: #212529; font-family: Arial; font-size: 18pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">O que você deveria fazer?</span></div><div dir="ltr" style="background-color: white; line-height: 1.872; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">Sua prioridade imediata deve ser verificar se você está usando a biblioteca maliciosa em questão. Em caso afirmativo, futuras compilações do seu aplicativo falharão, mas quaisquer aplicativos implantados anteriormente provavelmente conterão (e estarão potencialmente executando) o código mal-intencionado.</span></div><div dir="ltr" style="background-color: white; line-height: 1.872; margin-bottom: 0pt; margin-top: 0pt;"><br /></div><div dir="ltr" style="background-color: white; line-height: 1.872; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">Sugiro sempre monitorar as dependências open-source de um projeto, seja por código malicioso ou por bugs de segurança, </span><span style="background-color: transparent; color: #252525; font-family: Roboto; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">De acordo com um estudo da Universidade Carnegie Mellon, para cada mil linhas de código em software comercial, existem entre 20 a 30 bugs. E como os bugs são criados, as vulnerabilidades inevitavelmente seguem. </span></div><h2 dir="ltr" style="background-color: white; line-height: 1.44; margin-bottom: 4pt; margin-top: 0pt; padding: 15pt 0pt;"><span style="background-color: transparent; color: #212529; font-family: Arial; font-size: 18pt; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 400; vertical-align: baseline; white-space: pre-wrap;">Eu sou afetado, o que devo fazer a seguir?</span></h2><div dir="ltr" style="background-color: white; line-height: 1.872; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">Você deve primeiro eliminar o pacote malicioso do seu aplicativo, o que pode ser feito revertendo para a versão 3.3.4 do </span><span style="background-color: #f4f4f6; color: #b51b72; font-family: &quot;Courier New&quot;; font-size: 10.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">event-stream</span><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">.</span></div><div dir="ltr" style="background-color: white; line-height: 1.872; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">Se o seu aplicativo usou a biblioteca maliciosa e lida com o bitcoin, inspecione sua atividade nos últimos 3 meses para ver se algum bitcoin extraído ou transferido não entrou na sua carteira.</span></div><div dir="ltr" style="background-color: white; line-height: 1.872; margin-bottom: 0pt; margin-top: 0pt;"><br /></div><div dir="ltr" style="background-color: white; line-height: 1.872; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: #4a4a4a; font-family: Arial; font-size: 13.5pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">Se o seu aplicativo não lidar com o bitcoin, mas for especialmente sensível, recomendamos que você inspecione sua atividade nos últimos 3 meses em busca de qualquer atividade suspeita, principalmente dados enviados na rede para destinos não intencionais. Acreditamos ser improvável que o código faça algo além do roubo de bitcoin, mas a análise completa ainda está em andamento.</span></div><div dir="ltr" style="background-color: white; line-height: 1.872; margin-bottom: 0pt; margin-top: 0pt;"><br /></div><span id="docs-internal-guid-d87e5e7a-7fff-7c16-1db1-25e18c37bba2"></span><br /><div dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: Arial; font-size: 11pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">fontes: https://snyk.io/</span></div>